# OpenDrSai 

ç”±ä¸­å›½ç§‘å­¦é™¢é«˜èƒ½ç‰©ç†ç ”ç©¶æ‰€HepAIå›¢é˜Ÿå¼€å‘çš„æ™ºèƒ½ä½“ä¸å¤šæ™ºèƒ½ä½“ç³»ç»Ÿå¿«é€Ÿå¼€å‘å’Œéƒ¨ç½²ä¸€ä½“åŒ–æ¡†æ¶ï¼Œå¯å¿«é€Ÿåœ°å¼€å‘å’Œéƒ¨ç½²è‡ªå·±çš„æ™ºèƒ½ä½“ä¸å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿå‰åç«¯æœåŠ¡ã€‚

<div align="center">
  <p>
      <img width="30%" src="assets/drsai.png" alt="é€‚é…é€»è¾‘å›¾">
  </p>
</div>

è¯¥å¼€å‘æ¡†æ¶åŸºäºMicrosoftå¼€æºæ¡†æ¶[AutoGen](https://github.com/microsoft/autogen)ï¼ˆå½“å‰0.5.7ç‰ˆæœ¬ï¼‰ï¼Œåœ¨å…¼å®¹AutoGenå®Œæ•´ç»“æ„å’Œç›¸å…³ç”Ÿæ€çš„åŸºç¡€ä¸Šï¼Œé‡æ–°è®¾è®¡äº†æ™ºèƒ½ä½“å’Œå¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„ç»„ä»¶å’Œå·¥ä½œé€»è¾‘ï¼Œä½¿å…¶æ›´é€‚åˆäºå¼€å‘**ä¸“ä¸šç§‘å­¦æ™ºèƒ½ä½“å’Œå¤šæ™ºèƒ½ä½“ç³»ç»ŸğŸ¤–ï¼šå¦‚å¤æ‚å¤šä»»åŠ¡æ‰§è¡ŒğŸ’¡ã€çŠ¶æ€ç®¡ç†å’Œäººæœºäº¤äº’ğŸ™‹â€â™‚ï¸ğŸ™‹â€â™€ï¸ã€ä¸“ä¸šç§‘å­¦å·¥å…·ç®¡ç†å’Œæ‰§è¡ŒğŸ› ï¸ã€é•¿ä»»åŠ¡æ‰§è¡Œç®¡ç†â°ã€é•¿çŸ­è®°å¿†ç®¡ç†ç­‰ğŸ§ **ã€‚ä¸ä¸»æµMCPã€A2Aåè®®ã€HepAIçš„ç›¸å…³ç”Ÿæ€ã€RAGFlowç­‰ä¸»æµRAGæ¶æ„å…·æœ‰å¾ˆå¥½çš„å…¼å®¹æ€§ã€‚è€Œä¸”å…·å¤‡å¼€å‘éƒ¨ç½²ä¸€ä½“åŒ–èƒ½åŠ›ï¼Œæ™ºèƒ½ä½“æˆ–å¤šæ™ºèƒ½ä½“ç³»ç»Ÿä»£ç å¯ä¸€é”®å¯åŠ¨ï¼Œæ³¨å†Œä¸ºopenai ChatCompletionsæ ¼å¼ã€HepAI Workeræ ¼å¼ï¼Œä½œä¸ºAPIè°ƒç”¨ã€‚å¹¶é…å¥—ç›¸åº”çš„äººæœºäº¤äº’å‰ç«¯ï¼Œå¯ä»¥ç›´æ¥å¼€å‘éƒ¨ç½²å®Œæ•´çš„å‰åç«¯åº”ç”¨ã€‚

## 1.ç‰¹è‰²

- 1.å¯åŸºäº[HepAIå¹³å°](https://aiapi.ihep.ac.cn/)è¿›è¡Œæ™ºèƒ½ä½“åŸºåº§æ¨¡å‹çš„çµæ´»åˆ‡æ¢ï¼Œä»¥åŠå·¥å…·ã€çŸ¥è¯†åº“ç­‰æ™ºèƒ½ä½“ç»„ä»¶çš„çµæ´»é…ç½®ã€‚åŒæ—¶å…¼å®¹OpenAI ChatCompletionsï¼ŒOllamaç­‰æ¨¡å‹æ ¼å¼æ¥å…¥ã€‚
- 2.ä¸ºæ™ºèƒ½ä½“å’Œå¤šæ™ºèƒ½ä½“ç³»ç»Ÿè®¾è®¡äº†æ„ŸçŸ¥ã€æ€è€ƒã€è®°å¿†ã€æ‰§è¡Œã€çŠ¶æ€ç®¡ç†ç­‰é¢„å®šä¹‰ç»„ä»¶ï¼Œå¹¶è¿›è¡Œäº†æ’ä»¶åŒ–è®¾è®¡ï¼Œå¯çµæ´»æ‰©å±•ï¼Œæ»¡è¶³å¤šç§ä¸“ä¸šæ™ºèƒ½ä½“è®¾è®¡åº”ç”¨åœºæ™¯ã€‚
- 3.æä¾›äº†ä¸€é”®å¯åŠ¨çš„äººæœºäº¤äº’å‰åç«¯ï¼Œå®ç°äº†å¼€å‘å³åº”ç”¨ã€‚å¹¶ä¸ºæ™ºèƒ½ä½“å’Œå¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿäº¤äº’æä¾›äº†å…¼å®¹OpenAI ChatCompletionsã€OpenWebui-Pipelineçš„æ ‡å‡†åç«¯æ¥å£ï¼Œå¯å°†æ™ºèƒ½ä½“å’Œå¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿä½œä¸ºç¬¬ä¸‰æ–¹çš„æ¨¡å‹æˆ–æ™ºèƒ½ä½“APIæœåŠ¡ã€‚

## 2.å¿«é€Ÿå¼€å§‹

### 2.1.å®‰è£…OpenDrSai

#### æºç å®‰è£…
```shell
conda create -n drsai python=>3.11
conda activate drsai
git clone https://code.ihep.ac.cn/hepai/drsai drsai

cd python/packages/drsai && pip install -e. # for OpenDrSai backend and agent components
cd python/packages/drsai_ui && pip install -e. # for DrSai-UI  human-computer interaction frontend
```
#### pip å®‰è£…

```shell
conda create -n drsai python=>3.11
conda activate drsai
pip install drsai drsai_ui -U
```

#### é…ç½®HepAIå¹³å°çš„APIè®¿é—®å¯†é’¥

é…ç½®[HepAI](https://ai.ihep.ac.cn)DDF2å¹³å°çš„APIè®¿é—®å¯†é’¥ç­‰ç¯å¢ƒå˜é‡(Based on bash)ï¼š

linux/macå¹³å°:
```shell
vi ~/.bashrc
export HEPAI_API_KEY=your_api_key
source ~/.bashrc
```
windowså¹³å°ï¼š
```shell
setx "HEPAI_API_KEY" "your_api_key"
# æ³¨æ„ windowsç¯å¢ƒå˜é‡éœ€è¦é‡å¯ç”µè„‘æ‰ä¼šç”Ÿæ•ˆ
```

### 2.2.å‘½ä»¤è¡Œå¯åŠ¨OpenDrSaiæœåŠ¡

```shell
pip install drsai_ui -U 
drsai console --agent-config agent_config.yaml # å¯åŠ¨å‘½ä»¤è¡Œæ¨¡å¼çš„æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“æœåŠ¡
drsai backend --agent-config agent_config.yaml # å°†æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“éƒ¨ç½²ä¸ºOpenAIæ ¼å¼çš„åç«¯æ¨¡å‹æœåŠ¡
drsai ui # å¯åŠ¨Magenti-UIäººæœºäº¤äº’å‰ç«¯
```
**NOTE:**
- agent_config.yamlæ–‡ä»¶å±•ç¤ºäº†æ™ºèƒ½ä½“å’Œå¤šæ™ºèƒ½ä½“çš„é…ç½®ä¿¡æ¯ï¼Œè¿›è¡Œæ™ºèƒ½ä½“å°é²œï¼Œæˆ–è€…å‰ç«¯ç”¨æˆ·è‡ªå®šä¹‰é…ç½®æ™ºèƒ½ä½“æ—¶å¯ä»¥æ ¹æ®é…ç½®æ–‡ä»¶è¿›è¡Œæ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„å¿«é€Ÿåˆ›å»ºï¼Œä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```yaml
# å®šä¹‰ä½ çš„æ™ºèƒ½ä½“åŸºåº§æ¨¡å‹
model_config: &client
  provider: drsai.HepAIChatCompletionClient
  config:
    model: openai/gpt-4o
    api_key: sk-****
    base_url: "https://aiapi.ihep.ac.cn/apiv2"
    max_retries: 10
# ç»„è£…ä½ çš„æ™ºèƒ½ä½“
myassistant:
  type: AssistantAgent # å®šä¹‰æ™ºèƒ½ä½“ç±»å‹ï¼Œç”±OpenDrSaiæä¾›æˆ–è€…è‡ªå·±ä»£ç å¼€å‘
  name: myassistant
  system_message: "You are a helpful assistant who responds to user requests based on your tools and knowledge."
  description: "An agent that provides assistance with ability to use tools."
  model_client: *client
```
å…·ä½“çš„é…ç½®é¡¹è¯´æ˜è§[é…ç½®æ–‡ä»¶è¯´æ˜æ–‡æ¡£](docs/agent_factory.md)ã€‚åœ¨æˆ‘ä»¬[AIå¹³å°](https://drsai.ihep.ac.cn)ä¸Šï¼Œæä¾›äº†ä¸°å¯Œçš„æ™ºèƒ½ä½“çš„åŸºåº§æ¨¡å‹ã€MCP/HEPAI Workerå·¥å…·ã€RAGè®°å¿†æ’ä»¶ï¼›å¤šç§é€»è¾‘çš„æ™ºèƒ½ä½“å’Œå¤šæ™ºèƒ½ä½“æ¡†æ¶ï¼›ä¸€äº›é¢„è®¾çš„æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“å·¥ä½œæ¨¡å¼ä¾›ä½ é€‰æ‹©ã€‚ä½ å¯ä»¥åœ¨å‰åç«¯é€‰æ‹©é€‚åˆä½ çš„æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“æ¡†æ¶å’Œå·¥å…·ã€çŸ¥è¯†åº“ç­‰ï¼Œå¿«é€Ÿæ­å»ºè‡ªå·±çš„æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿã€‚é€šè¿‡é…ç½®å¿«é€Ÿæ„å»ºæ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“ç³»ç»Ÿè¯¦ç»†çš„è¯´æ˜è§ï¼š```docs/agent_factory.md```.

## 3.è¯¦ç»†æ–‡æ¡£
è¯¦ç»†çš„æ•™ç¨‹è§tutorialsç›®å½•ï¼š
```
tutorials/base01-hepai.mdï¼šHepAIå¹³å°çš„æ¨¡å‹é…ç½®å’Œä½¿ç”¨
tutorials/base02-worker.mdï¼šHEPAI Workerè¿œç¨‹å‡½æ•°çš„é…ç½®å’Œä½¿ç”¨
tutorials/base03-use_claude-code.mdï¼šåŸºHepAIå¹³å°äºClaude-Codeçš„ä½¿ç”¨
tutorials/agentsï¼šæ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ¡ˆä¾‹
tutorials/componentsï¼šæ™ºèƒ½ä½“ç»„ä»¶å¼€å‘æ¡ˆä¾‹
```

æ–‡æ¡£è¯´æ˜è§docsç›®å½•ï¼š
```
docs/develop.md: æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“ç³»ç»Ÿä»£ç å¼€å‘è¯´æ˜
docs/agent_factory.md: æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“å¼€æ”¾å’Œç¤¾åŒºå¼€å‘æŒ‡å—
docs/drsai_ui.md: äººæœºäº¤äº’å‰ç«¯ä½¿ç”¨æŒ‡å—
docs/open-webui.mdï¼šOpenAIæ ¼å¼çš„å‰ç«¯è®¿é—®ï¼Œä»¥åŠOpenWebuiçš„Pipelineæ’ä»¶çš„ä½¿ç”¨æŒ‡å—
```

## 4.å‚ä¸è´¡çŒ®

æ¬¢è¿å‚ä¸OpenDrSaiçš„å¼€å‘ï¼Œè´¡çŒ®ä»£ç ã€æ–‡æ¡£ã€é—®é¢˜ã€å»ºè®®ç­‰ã€‚æˆ‘ä»¬ç¤¾åŒºæ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

- ä»£ç è´¡çŒ®ï¼šåŒ…æ‹¬æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“ç³»ç»Ÿç»„ä»¶å¼€å‘ã€æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ¡ˆä¾‹ã€å‰ç«¯UIå¼€å‘ç­‰ã€‚
- æ–‡æ¡£è´¡çŒ®ï¼šåŒ…æ‹¬æ™ºèƒ½ä½“/å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ–‡æ¡£ã€æ•™ç¨‹ã€FAQç­‰ã€‚
- é—®é¢˜åé¦ˆï¼šåŒ…æ‹¬Bugåé¦ˆã€åŠŸèƒ½å»ºè®®ã€ä½¿ç”¨é—®é¢˜ç­‰ã€‚
- ç¤¾åŒºæ´»åŠ¨ï¼šåŒ…æ‹¬çº¿ä¸‹æ´»åŠ¨ã€çº¿ä¸Šæ²™é¾™ã€çº¿ä¸Šåˆ†äº«ç­‰ã€‚ 

## 5.è”ç³»æˆ‘ä»¬

- é‚®ç®±ï¼šhepai@ihep.ac.cn/xiongdb@ihep.ac.cn
- å¾®ä¿¡ï¼šxiongdongbo_12138
- å¾®ä¿¡ç¾¤èŠï¼šHepAIå¤§æ¨¡å‹æŠ€æœ¯äº¤æµ3ç¾¤ï¼š
![alt text](assets/å¾®ä¿¡ä¸‰ç¾¤.jpg)